<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„Ø´Ø§Øª â€” ARABI chat</title>
<style>
:root{
  --bg:#0f1114;
  --panel:#111418;
  --mine:#1900fd;
  --other:#2a2f36;
  --text:#eaf6f3;
}
body{
  margin:0;
  height:100vh;
  background:#0b1316;
  color:var(--text);
  font-family:"Cairo",sans-serif;
  display:flex;
  flex-direction:column;
  direction:rtl;
}
.header{
  background:#111418;
  padding:14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid #222;
}
.header h1{margin:0;font-size:18px;color:var(--mine);}
.header button{
  background:#ff4d4d;
  border:none;
  padding:6px 12px;
  border-radius:8px;
  color:#fff;
  cursor:pointer;
  font-weight:600;
}
.chat-wrap{display:flex;flex-direction:column;height:100vh;}
.messages{
  flex:1;
  overflow-y:auto;
  padding:22px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.msg-row{display:flex;gap:12px;align-items:flex-start;width:100%}
.msg-other{justify-content:flex-start;direction:ltr}
.msg-mine{justify-content:flex-end;direction:ltr}
.avatar{width:44px;height:44px;border-radius:50%;object-fit:cover;cursor:pointer}
.bubble{max-width:78%;padding:10px 14px;border-radius:14px;color:var(--text);box-shadow:0 6px 18px rgba(0,0,0,0.4);display:flex;flex-direction:column;gap:4px}
.msg-mine .bubble{background:var(--mine);border-bottom-right-radius:4px;text-align:right}
.msg-other .bubble{background:var(--other);border-bottom-left-radius:4px;text-align:right}
.bubble .who{font-weight:700;font-size:14px}
.bubble .text{font-size:16px}
.bubble .meta{font-size:12px;opacity:.6}
.input-area{
  padding:12px;
  display:flex;
  gap:10px;
  background:#111;
}
.input-area input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#222;
  color:#fff;
}
.btn-send{
  padding:10px 16px;
  border-radius:10px;
  border:none;
  background:var(--mine);
  color:#04221b;
  font-weight:700;
  cursor:pointer
}
#userMenu{display:none;position:absolute;background:#111;padding:10px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.4);z-index:100}
#userMenu div{padding:6px 12px;cursor:pointer}
#userMenu div:hover{background:#222}
/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±ØªØ¨ */
.rank-Ù…Ø¯ÙŠØ± { color: gold; font-weight: bold; }
.rank-Ø³ÙˆØ¨Ø± { color: orange; font-weight: bold; }
.rank-Ø£Ø¯Ù…Ù† { color: greenyellow; font-weight: bold; }
.rank-Ù…Ø´Ø±Ù { color: deepskyblue; font-weight: bold; }
.rank-Ø¨Ø±ÙˆÙ…ÙŠÙ… { color: cyan; font-weight: bold; }
.rank-Ø¹Ø¶Ùˆ  { color: gray; font-weight: bold; }
</style>
</head>
<body>

<div class="chat-wrap">
<div class="header">
<h1>ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h1>
<button onclick="leaveChat()">Ø®Ø±ÙˆØ¬</button>
</div>

<div class="messages" id="messages"></div>

<div class="input-area">
<input id="msgInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." autocomplete="off" />
<button class="btn-send" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
</div>
</div>

<div id="userMenu">
<div onclick="setRank('ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹')">ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
<div onclick="setRank('â­ Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†')">â­ Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†</div>
<div onclick="setRank('ğŸ… Ø£Ø¯Ù…Ù†')">ğŸ… Ø£Ø¯Ù…Ù†</div>
<div onclick="setRank('ğŸ›¡ï¸ Ù…Ø´Ø±Ù')">ğŸ›¡ï¸ Ù…Ø´Ø±Ù</div>
<div onclick="setRank('ğŸ’ Ø¨Ø±ÙˆÙ…ÙŠÙ…')">ğŸ’ Ø¨Ø±ÙˆÙ…ÙŠÙ…</div>
<div onclick="setRank('ğŸ‘¤ Ø¹Ø¶Ùˆ')">ğŸ‘¤ Ø¹Ø¶Ùˆ</div>
</div>

<script>
const username = localStorage.getItem("username") || "MOHAMED";
const avatar = localStorage.getItem("avatar") || "https://i.pravatar.cc/60";

const messagesDiv = document.getElementById("messages");
const input = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");

const userRanks = { [username]: "ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹" };
const adminUser = "MOHAMED"; // ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ¹Ø·ÙŠ Ø§Ù„Ø±ØªØ¨

function getUserRank(user){
  return userRanks[user] || "ğŸ‘¤ Ø¹Ø¶Ùˆ";
}

function getRankClass(rank){
  if(rank.includes("Ù…Ø¯ÙŠØ±")) return "rank-Ù…Ø¯ÙŠØ±";
  if(rank.includes("Ø³ÙˆØ¨Ø±")) return "rank-Ø³ÙˆØ¨Ø±";
  if(rank.includes("Ø£Ø¯Ù…Ù†")) return "rank-Ø£Ø¯Ù…Ù†";
  if(rank.includes("Ù…Ø´Ø±Ù")) return "rank-Ù…Ø´Ø±Ù";
  if(rank.includes("Ø¨Ø±ÙˆÙ…ÙŠÙ…")) return "rank-Ø¨Ø±ÙˆÙ…ÙŠÙ…";
  return "rank-Ø¹Ø¶Ùˆ";
}

function addMessageToDOM(user, avatarUrl, text, isMine=false, timeStr=null){
  const row = document.createElement("div");
  row.className = "msg-row " + (isMine ? "msg-mine" : "msg-other");

  const rank = getUserRank(user);
  const rankClass = getRankClass(rank);

  row.innerHTML = `
    <img class="avatar" src="${escapeHtml(avatarUrl)}" alt="avatar" onclick="showUserMenu('${user}', event)">
    <div class="bubble">
      <div class="who">${escapeHtml(user)} <span class="${rankClass}">${rank}</span></div>
      <div class="text">${escapeHtml(text)}</div>
      <div class="meta">${timeStr || (new Date()).toLocaleTimeString()}</div>
    </div>
  `;
  messagesDiv.appendChild(row);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function sendMessage(){
  const txt = input.value.trim();
  if(!txt) return;
  addMessageToDOM(username, avatar, txt, true, new Date().toLocaleTimeString());
  input.value = "";
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){sendMessage()} });

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m]));
}

let selectedUser = null;
function showUserMenu(user, e){
  if(username !== adminUser) return; // ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ù†ÙŠÙˆ
  selectedUser = user;
  const menu = document.getElementById("userMenu");
  menu.style.display = "block";
  menu.style.top = e.clientY + "px";
  menu.style.left = e.clientX + "px";
}

function setRank(rank){
  if(username !== adminUser) return; // ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ¹Ø·ÙŠ Ø§Ù„Ø±ØªØ¨
  if(selectedUser){
    const oldRank = getUserRank(selectedUser);
    userRanks[selectedUser] = rank;

    // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ø¥Ø¸Ù‡Ø§Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø±ØªØ¨Ø©
    addMessageToDOM(
      "Ø§Ù„Ù†Ø¸Ø§Ù…",
      "https://i.pravatar.cc/60",
      `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ Ù„Ù‚Ø¯ Ø£Ø®Ø° ${selectedUser} Ø±ØªØ¨Ø© ${rank} (ÙƒØ§Ù†Øª ${oldRank})`,
      false
    );
  }
  document.getElementById("userMenu").style.display = "none";
}

document.addEventListener("click",(e)=>{
  if(!e.target.closest("#userMenu") && !e.target.classList.contains("avatar")){
    document.getElementById("userMenu").style.display="none";
  }
});

function leaveChat(){
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù…Ù† Ø§Ù„Ø´Ø§Øª!");
  window.location.href = "index.html";
}

// Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
addMessageToDOM("Ø§Ù„Ù†Ø¸Ø§Ù…", avatar, username + " Ø¯Ø®Ù„ Ø§Ù„Ø´Ø§Øª", false);
</script>
</body>
</html>
